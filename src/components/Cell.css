.cell {
  position: relative;
  width: var(--cell-size);
  height: var(--cell-size);
  border-radius: 3px;
  background-color: var(--cell-empty);
  overflow: visible;
  contain: layout style;
}

/* Outer bevel — thick raised edge, strong directional light */
.cell--filled {
  border-radius: 3px;
  box-shadow:
    inset 0 5px 0 0 rgba(255, 255, 255, 0.7),
    inset 0 -5px 0 0 rgba(0, 0, 0, 0.8),
    inset 4.5px 0 0 0 rgba(255, 255, 255, 0.4),
    inset -4.5px 0 0 0 rgba(0, 0, 0, 0.55),
    0 2px 4px rgba(0, 0, 0, 0.35);
  animation: cell-place 0.12s ease-out;
}

/* Inner face — recessed gem with groove channel and convex gloss */
.cell--filled::before {
  content: '';
  position: absolute;
  inset: 4px;
  border-radius: 2px;
  background: linear-gradient(
    140deg,
    rgba(255, 255, 255, 0.4) 0%,
    rgba(255, 255, 255, 0.12) 30%,
    rgba(0, 0, 0, 0.02) 55%,
    rgba(0, 0, 0, 0.18) 100%
  );
  box-shadow:
    inset 0 1px 2px rgba(255, 255, 255, 0.25),
    inset 0 -1px 1px rgba(0, 0, 0, 0.15),
    0 0 0 1px rgba(0, 0, 0, 0.35);
  pointer-events: none;
}

/* Ghost — colored with pulse + glow */
.cell--ghost-valid {
  background-color: var(--ghost-color, var(--ghost-valid)) !important;
  border-radius: 3px;
  box-shadow:
    inset 0 0 0 1.5px rgba(255, 255, 255, 0.7),
    0 0 8px 2px rgba(255, 255, 255, 0.2);
  animation: ghost-pulse 0.8s ease-in-out infinite alternate;
}
.cell--ghost-valid::before {
  display: none;
}

.cell--ghost-invalid {
  background-color: var(--ghost-invalid) !important;
  box-shadow: none;
}
.cell--ghost-invalid::before {
  display: none;
}

/* Ghost cells that would complete a line — brighter glow as anticipation cue */
.cell--ghost-completing {
  outline: 1.5px solid rgba(255, 255, 255, 0.8);
  outline-offset: -1.5px;
  animation: ghost-completing-pulse 0.6s ease-in-out infinite alternate;
}

@keyframes ghost-completing-pulse {
  from {
    opacity: 0.6;
  }
  to {
    opacity: 0.9;
  }
}

/* Preview — cells in rows/cols that would be cleared by current ghost placement */
.cell--preview-clear {
  filter: brightness(1.5);
  outline: 1.5px solid rgba(255, 255, 255, 0.5);
  outline-offset: -1.5px;
  z-index: 5;
  animation: preview-clear-pulse 0.6s ease-in-out infinite alternate;
}

@keyframes preview-clear-pulse {
  from { opacity: 0.75; }
  to { opacity: 1; }
}

/* During active drag: ghost cells snap in instantly — crisp and defined */
.board--dragging .cell--ghost-valid {
  animation: none;
  opacity: 0.88;
  box-shadow:
    inset 0 0 0 1px rgba(255, 255, 255, 0.35);
  filter: none;
}
.board--dragging .cell--ghost-completing {
  animation: none;
  opacity: 0.95;
  outline: 1.5px solid rgba(255, 255, 255, 0.6);
  outline-offset: -1.5px;
}
.board--dragging .cell--preview-clear {
  animation: none;
  opacity: 0.55;
  filter: none;
  outline: none;
}

/* Anticipation pulse — all clearing cells flash simultaneously before cascade */
.cell--pre-clear {
  animation: cell-anticipate 50ms ease-out forwards;
  z-index: 10;
  will-change: transform, filter;
}

/* Line clear — fast flash + staggered cascade */
.cell--clearing {
  animation: cell-clear 0.24s ease-out forwards;
  will-change: transform, opacity, filter;
}

.cell--clearing::after {
  content: '';
  position: absolute;
  inset: -6px;
  border-radius: 6px;
  background: radial-gradient(
    circle,
    rgba(255, 255, 255, 0.9) 0%,
    rgba(255, 255, 255, 0.3) 45%,
    transparent 75%
  );
  animation: cell-sparkle 0.24s ease-out forwards;
  animation-delay: inherit;
  pointer-events: none;
}

/* Placement — hard snap with minimal overshoot */
@keyframes cell-place {
  0% {
    transform: scale(0.65);
    opacity: 0.5;
  }
  50% {
    transform: scale(1.08);
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

/* Clear — hard white flash then rapid vanish */
@keyframes cell-clear {
  0% {
    transform: scale(1);
    opacity: 1;
    filter: brightness(1);
  }
  20% {
    transform: scale(1.12);
    opacity: 1;
    filter: brightness(3);
  }
  100% {
    transform: scale(0.2);
    opacity: 0;
    filter: brightness(2);
  }
}

@keyframes cell-sparkle {
  0% {
    transform: scale(0.4);
    opacity: 0;
  }
  25% {
    transform: scale(1.2);
    opacity: 1;
  }
  100% {
    transform: scale(2);
    opacity: 0;
  }
}

/* Ghost pulse */
@keyframes ghost-pulse {
  from {
    opacity: 0.65;
  }
  to {
    opacity: 0.9;
  }
}

/* Game over shatter */
.cell--shattered {
  animation: cell-shatter 0.7s ease-in forwards;
  will-change: transform, opacity;
}

@keyframes cell-shatter {
  0% {
    transform: translateX(0) translateY(0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform:
      translateX(var(--shatter-x, 0px))
      translateY(var(--shatter-y, 30px))
      rotate(var(--shatter-rot, 0deg));
    opacity: 0;
  }
}


/* Post-clear settle bounce — cells adjacent to cleared cells jiggle */
.cell--settling {
  animation: cell-settle 0.2s ease-out;
  will-change: transform;
}

@keyframes cell-settle {
  0% {
    transform: translateY(0);
  }
  30% {
    transform: translateY(2px);
  }
  60% {
    transform: translateY(-1px);
  }
  100% {
    transform: translateY(0);
  }
}

/* Anticipation — hard brightness spike before clear */
@keyframes cell-anticipate {
  0% {
    transform: scale(1);
    filter: brightness(1);
  }
  50% {
    transform: scale(1.06);
    filter: brightness(2.2);
  }
  100% {
    transform: scale(1.03);
    filter: brightness(1.6);
  }
}
